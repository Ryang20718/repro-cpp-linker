load("@bazel_skylib//rules:expand_template.bzl", "expand_template")

expand_template(
    name = "expand_tif_config",
    template = "libtiff/tif_config.h.in",
    out = "libtiff/tif_config.h",
    substitutions = {
        "#undef HAVE_FCNTL_H": "#define HAVE_FCNTL_H 1",
        "#undef HAVE_UNISTD_H": "#define HAVE_UNISTD_H 1",
        "#undef HAVE_SYS_TYPES_H": "#define HAVE_SYS_TYPES_H 1",
        "#undef SIZEOF_SIZE_T": "#define SIZEOF_SIZE_T 8",
        "#undef LERC_SUPPORT": "#define LERC_SUPPORT 1",
        "#undef ZSTD_SUPPORT": "#define ZSTD_SUPPORT 1",
    },
)

expand_template(
    name = "expand_tiffconf",
    template = "libtiff/tiffconf.h.in",
    out = "libtiff/tiffconf.h",
    substitutions = {
        "#undef TIFF_SSIZE_T": "#define TIFF_SSIZE_T signed long",
        "#undef HAVE_IEEEFP": "#define HAVE_IEEEFP 1",
        "#undef PIXARLOG_SUPPORT": "#define PIXARLOG_SUPPORT 1",
        "#undef ZIP_SUPPORT": "#define ZIP_SUPPORT 1",
        "#undef LZW_SUPPORT": "#define LZW_SUPPORT 1",
        "#undef JPEG_SUPPORT": "#define JPEG_SUPPORT 1",
    },
)

cc_library(
    name = "tiff",
    srcs = [
        "libtiff/tif_config.h",
        "libtiff/tiffconf.h",
        "libtiff/tif_aux.c",
        "libtiff/tif_close.c",
        "libtiff/tif_codec.c",
        "libtiff/tif_color.c",
        "libtiff/tif_compress.c",
        "libtiff/tif_dir.c",
        "libtiff/tif_dirinfo.c",
        "libtiff/tif_dirread.c",
        "libtiff/tif_dirwrite.c",
        "libtiff/tif_dumpmode.c",
        "libtiff/tif_error.c",
        "libtiff/tif_extension.c",
        "libtiff/tif_fax3.c",
        "libtiff/tif_fax3sm.c",
        "libtiff/tif_fax3.h",
        "libtiff/tif_flush.c",
        "libtiff/tif_getimage.c",
        "libtiff/tif_hash_set.c",
        "libtiff/tif_hash_set.h",
        "libtiff/tif_jbig.c",
        "libtiff/tif_jpeg.c",
        "libtiff/tif_jpeg_12.c",
        "libtiff/tif_lerc.c",
        "libtiff/tif_luv.c",
        "libtiff/tif_lzma.c",
        "libtiff/tif_lzw.c",
        "libtiff/tif_next.c",
        "libtiff/tif_ojpeg.c",
        "libtiff/tif_open.c",
        "libtiff/tif_packbits.c",
        "libtiff/tif_pixarlog.c",
        "libtiff/tif_predict.c",
        "libtiff/tif_print.c",
        "libtiff/tif_read.c",
        "libtiff/tif_strip.c",
        "libtiff/tif_swab.c",
        "libtiff/tif_thunder.c",
        "libtiff/tif_tile.c",
        "libtiff/tif_version.c",
        "libtiff/tif_warning.c",
        "libtiff/tif_webp.c",
        "libtiff/tif_write.c",
        "libtiff/tif_zip.c",
        "libtiff/tif_zstd.c",
        "libtiff/t4.h",
        "libtiff/tif_dir.h",
        "libtiff/tif_predict.h",
        "libtiff/tiffiop.h",
        "libtiff/uvcode.h",
        "libtiff/tif_unix.c"
    ],
    hdrs = [
        "libtiff/tiff.h",
        "libtiff/tiffio.h",
        "libtiff/tiffvers.h",
    ],
    includes = ["libtiff"],
    deps = [
        "@zlib",
        "@zstd",
        "@jpeg",
        "@lerc",
    ],
    visibility = ["//visibility:public"],
)
